<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>发送方</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div>myid is [<span id="myId">正在加载中</span>]</div>
    <div>other peer id: <input type="text" id="otherId" style="width: 300px;"
            value="83753fbd-bd61-4ae5-b28c-7d019cdc35d4"/>&nbsp;&nbsp;状态:<span id="status-span">无状态</span></div>
    <button id="connect-btn">connect</button>
    <div style="height: 400px;border: 1px solid black; margin: 20px;">
        <div>发送方&nbsp;&nbsp;<button id="send-btn">发送</button></div>
        <textarea style="width:100%;height: 100px;" id="send-textare"></textarea>
        <div>消息日志</div>
        <div id="sendHistory" style="height:250px; border: 1px solid pink"></div>
    </div>
    <div style="height: 400px;border: 1px solid black; margin: 20px;">
        <div>接收方</div>
        <div>消息日志</div>
        <div id="receiveHistory" style="height:350px; border: 1px solid pink"></div>
    </div>
    <script>
        console.log('fuck', Crypto.randomUUID());
        var peer = new Peer();
        peer.on('open', function (id) {
            $("#status-span").text("加载到了自己的id");
            $("#myId").text(id);
        });
        var conn;
        $("#connect-btn").click(function () {
            $("#status-span").text("正在连接对方");
            conn = peer.connect($("#otherId").val());
            conn.on('open', function () {
                $("#status-span").text("连接成功!");
                conn.on('data', function (data) {
                    $("#receiveHistory").append("<div>" + data + "</div>");
                });
            });
        })
        $("#send-btn").click(() => {
            conn.send($("#send-textare").val());
            $("#sendHistory").append("<div>" + $("#send-textare").val() + "</div>");
            $("#send-textare").val("");
        });
    </script>
</body>
</html>